---
title: "Heart Disease Risk Analysis"
author: "Oceanus Zhang"
date: "`r Sys.Date()`"
output: html_document
knit: (function(input, ...) { setwd("/Users/oceanuszhang/Desktop/heart+disease"); rmarkdown::render(input, ...) })
---

# **Introduction**
The **Heart Disease dataset** from the **UCI Machine Learning Repository** contains records from four different databases (Cleveland, Hungary, Switzerland, and the VA Long Beach). The **Cleveland database** is the primary dataset used in machine learning research, containing **14 key features** related to heart disease diagnosis. 

This project aims to:  

- **Perform exploratory data analysis (EDA):**  
  - Summarize the dataset using basic statistics.  
  - Create visualizations to understand the data structure and variable distributions.  

- **Develop a classification model (Future work):**  
  - Train a predictive model to classify the presence of heart disease.  
  - Compare different machine learning algorithms for optimal performance.  

- **Evaluate model performance (Future work):**  
  - Use accuracy, precision, recall, and F1-score to assess model effectiveness.  
  - Analyze the ROC curve and AUC to measure classification quality.  
  
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,      
  message = FALSE,  
  warning = FALSE   
)
```

# **Loading the Data**
```{r}
# Load necessary libraries
library(tidyverse)
library(knitr)
library(gt)  
library(ggplot2)
library(here)

# Define file path
data_path <- here::here("heart+disease/processed.cleveland.data")

# Load data
heart_data <- read.table(data_path, sep = ",", header = FALSE, na.strings = "?")

# Assign column names based on UCI ML description
colnames(heart_data) <- c("Age", "Sex", "CP", "Trestbps", "Chol", "FBS",
                          "RestECG", "Thalach", "Exang", "Oldpeak", "Slope",
                          "CA", "Thal", "Target")

# Display first few rows
kable(head(heart_data))
```
# **Data Preprocess**
```{r}
# Convert categorical variables to factors
heart_data$Sex <- factor(heart_data$Sex, levels = c(0, 1), labels = c("Female", "Male"))
heart_data$CP <- factor(heart_data$CP, levels = c(1, 2, 3, 4), labels = c("Typical", "Atypical", "Non-anginal", "Asymptomatic"))
heart_data$FBS <- factor(heart_data$FBS, levels = c(0, 1), labels = c("False", "True"))
heart_data$RestECG <- factor(heart_data$RestECG, levels = c(0, 1, 2), labels = c("Normal", "ST-T wave abnormality", "LVH"))
heart_data$Exang <- factor(heart_data$Exang, levels = c(0, 1), labels = c("No", "Yes"))
heart_data$Thal <- factor(heart_data$Thal, levels = c(3, 6, 7), labels = c("Normal", "Fixed defect", "Reversible defect"))
heart_data$Target <- factor(heart_data$Target, levels = c(0, 1, 2, 3, 4), labels = c("No Disease", "Mild", "Moderate", "Severe", "Critical"))

# Handle missing values (replace NA with median for numeric columns)
heart_data <- heart_data %>%
  mutate(across(where(is.numeric), ~ replace_na(., median(., na.rm = TRUE))))

# Check dataset summary
summary(heart_data)
```
# **Summary Table**
```{r}
summary_table <- heart_data %>%
  summarise(
    mean_age = mean(Age, na.rm = TRUE),
    mean_trestbps = mean(Trestbps, na.rm = TRUE),
    mean_chol = mean(Chol, na.rm = TRUE),
    mean_thalach = mean(Thalach, na.rm = TRUE),
    disease_count = sum(Target != "No Disease", na.rm = TRUE),  
    no_disease_count = sum(Target == "No Disease", na.rm = TRUE)
  )

summary_table %>%
  gt() %>%
  tab_header(title = "Summary of Heart Disease Dataset")

```
The table below provides key summary statistics for the heart disease dataset:

- The **average age** of individuals in the dataset is `r round(summary_table$mean_age, 2)` years.
- The **mean resting blood pressure** is `r round(summary_table$mean_trestbps, 2)` mm Hg.
- The **mean cholesterol level** recorded is `r round(summary_table$mean_chol, 2)` mg/dL.
- The **mean maximum heart rate achieved** is `r round(summary_table$mean_thalach, 2)` bpm.
- A total of **`r summary_table$disease_count`** individuals (**`r round((summary_table$disease_count / (summary_table$disease_count + summary_table$no_disease_count)) * 100, 2)`**%) have been diagnosed with heart disease.
- A total of **`r summary_table$no_disease_count`** individuals (**`r round((summary_table$no_disease_count / (summary_table$disease_count + summary_table$no_disease_count)) * 100, 2)`**%) do not have heart disease.


# **Visualization: Age Distribution by Heart Disease Status**
```{r}
ggplot(heart_data, aes(x = Age, fill = Target)) +
  geom_histogram(binwidth = 5, position = "dodge") +
  labs(title = "Age Distribution by Heart Disease Status",
       x = "Age",
       y = "Count",
       fill = "Heart Disease Severity") +
  theme_minimal()

```

The histogram above illustrates the **Age distribution** of individuals categorized by heart disease severity. The **x-axis** represents age, while the **y-axis** represents the count of individuals within each age group.  

- The **red bars** correspond to individuals with **no diagnosed heart disease**, forming the majority in younger age groups.  
- The **other colors** (green, blue, and purple) represent **varying severity levels** of heart disease, with a noticeable increase in cases around the **50â€“60 age range**.  
- A **higher frequency of heart disease cases** appears in older age groups, suggesting an **age-related risk factor** for heart disease.  

